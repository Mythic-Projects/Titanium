From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Peridot <peridot491@protonmail.com>
Date: Wed, 4 Jan 2023 17:32:32 +0100
Subject: [PATCH] Backport some message sending API


diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
index 0341d5cfba4cf6251fcd82090174226d75a91fde..48b26669081ee3d6e29a1b64d0f3f62c107db480 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
@@ -261,11 +261,9 @@ public class CraftPlayer extends CraftHumanEntity implements Player {
 
     // Titanium start
     @Override
-    public void sendActionBar(BaseComponent... message) {
-        if(getHandle().playerConnection == null) return;
-        PacketPlayOutChat packet = new PacketPlayOutChat(null, (byte) 2);
-        packet.components = message;
-        getHandle().playerConnection.sendPacket(packet);
+    public void sendActionBar(String message) {
+        if(getHandle().playerConnection == null || message == null || message.isEmpty()) return;
+        getHandle().playerConnection.sendPacket(new PacketPlayOutChat(IChatBaseComponent.ChatSerializer.a("{\"text\":\"" + message + "\"}"), (byte) 2));
     }
     // Titanium end
 
@@ -1636,6 +1634,24 @@ public class CraftPlayer extends CraftHumanEntity implements Player {
             getHandle().playerConnection.sendPacket(packet);
         }
 
+        @Override
+        public void sendMessage(net.md_5.bungee.api.ChatMessageType position, BaseComponent component) {
+            sendMessage( position, new BaseComponent[] { component } );
+        }
+
+        @Override
+        public void sendMessage(net.md_5.bungee.api.ChatMessageType position, BaseComponent... components) {
+            if ( getHandle().playerConnection == null ) return;
+
+            PacketPlayOutChat packet = new PacketPlayOutChat(null, (byte) position.ordinal());
+            // Action bar doesn't render colours, replace colours with legacy section symbols
+            if (position == net.md_5.bungee.api.ChatMessageType.ACTION_BAR) {
+                components = new BaseComponent[]{new net.md_5.bungee.api.chat.TextComponent(BaseComponent.toLegacyText(components))};
+            }
+            packet.components = components;
+            getHandle().playerConnection.sendPacket(packet);
+        }
+
         // PaperSpigot start - Implement affects spawning API
         @Override
         public boolean getAffectsSpawning() {
