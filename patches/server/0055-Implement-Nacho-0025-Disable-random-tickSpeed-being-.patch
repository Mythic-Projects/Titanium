From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Peridot <peridot491@protonmail.com>
Date: Sun, 22 May 2022 23:11:39 +0200
Subject: [PATCH] Implement [Nacho-0025] Disable random tickSpeed being
 modified and make it configurable


diff --git a/src/main/java/net/minecraft/server/World.java b/src/main/java/net/minecraft/server/World.java
index 16441d096f33ee96484a0a38df7a476442b58b82..46ffc14d0bc6ec6ab0a8c53562697e9eeaf13d01 100644
--- a/src/main/java/net/minecraft/server/World.java
+++ b/src/main/java/net/minecraft/server/World.java
@@ -10,6 +10,7 @@ import net.titanium.config.PaperWorldConfig;
 import net.titanium.config.SpigotWorldConfig;
 import net.titanium.config.TacoSpigotWorldConfig;
 import net.titanium.config.TitaniumConfig;
+import net.titanium.config.TitaniumWorldConfig;
 import org.bukkit.Bukkit;
 import org.bukkit.block.BlockState;
 import org.bukkit.craftbukkit.CraftServer;
@@ -173,6 +174,7 @@ public abstract class World implements IBlockAccess {
     public final org.github.paperspigot.PaperSpigotWorldConfig paperSpigotConfig; // PaperSpigot
      */
 
+    public final TitaniumWorldConfig titaniumConfig;
     public final SpigotWorldConfig spigotConfigTitanium;
     public final PaperWorldConfig paperConfigTitanium;
     public final TacoSpigotWorldConfig tacoConfigTitanium;
@@ -205,6 +207,7 @@ public abstract class World implements IBlockAccess {
         this.paperSpigotConfig = new org.github.paperspigot.PaperSpigotWorldConfig( worlddata.getName() ); // PaperSpigot
          */
         TitaniumConfig serverConfig = TitaniumConfig.get();
+        this.titaniumConfig = serverConfig.worldSettings;
         this.spigotConfigTitanium = serverConfig.spigot.worldSettings;
         this.paperConfigTitanium = serverConfig.paper.worldSettings;
         this.tacoConfigTitanium = serverConfig.taco.worldSettings;
diff --git a/src/main/java/net/minecraft/server/WorldServer.java b/src/main/java/net/minecraft/server/WorldServer.java
index 8fa99c50f679a275f00cd1e9a7fa99c8f91274b8..1b7b28f9897f04141bdbaa86180fc923dcb962cf 100644
--- a/src/main/java/net/minecraft/server/WorldServer.java
+++ b/src/main/java/net/minecraft/server/WorldServer.java
@@ -479,7 +479,7 @@ public class WorldServer extends World implements IAsyncTaskHandler {
 
                 this.methodProfiler.c("tickBlocks");
                 timings.chunkTicksBlocks.startTiming(); // Spigot
-                i1 = this.getGameRules().c("randomTickSpeed");
+                i1 = titaniumConfig.disabledGamerules.randomTickSpeed ? 3 : this.getGameRules().c("randomTickSpeed");
                 if (i1 > 0) {
                     ChunkSection[] achunksection = chunk.getSections();
                     int j1 = achunksection.length;
diff --git a/src/main/java/net/titanium/config/TitaniumConfig.java b/src/main/java/net/titanium/config/TitaniumConfig.java
index f363e1398c02dd90736fc61b02be89e8e446496f..cfb948386b3e4dd36ea51ef3a860420117dc3efe 100644
--- a/src/main/java/net/titanium/config/TitaniumConfig.java
+++ b/src/main/java/net/titanium/config/TitaniumConfig.java
@@ -104,6 +104,8 @@ public class TitaniumConfig extends TitaniumConfigSection {
     @Comment("Enable this option only if some of your plugins are not compatible with the new configs.")
     public boolean enableLegacyConfigFiles = false;
 
+    public TitaniumWorldConfig worldSettings = new TitaniumWorldConfig();
+
     public Commands commands = new Commands();
 
     public static class Commands extends TitaniumConfigSection {
diff --git a/src/main/java/net/titanium/config/TitaniumWorldConfig.java b/src/main/java/net/titanium/config/TitaniumWorldConfig.java
new file mode 100644
index 0000000000000000000000000000000000000000..026aeb4004e8a4113988c6294557238ecde97eec
--- /dev/null
+++ b/src/main/java/net/titanium/config/TitaniumWorldConfig.java
@@ -0,0 +1,24 @@
+package net.titanium.config;
+
+import eu.okaeri.configs.annotation.Comment;
+import eu.okaeri.configs.annotation.NameModifier;
+import eu.okaeri.configs.annotation.NameStrategy;
+import eu.okaeri.configs.annotation.Names;
+
+@Names(strategy = NameStrategy.HYPHEN_CASE, modifier = NameModifier.TO_LOWER_CASE)
+public class TitaniumWorldConfig extends TitaniumConfigSection {
+
+    public DisabledGamerules disabledGamerules = new DisabledGamerules();
+
+    public static class DisabledGamerules extends TitaniumConfigSection {
+
+        @Comment("Whether gamerule randomTickSpeed should be enabled or not.")
+        @Comment("Plants growth, leaf decay, fire spread etc. depends on this value.")
+        @Comment("Normally we have to cast String to Integer every tick which is costly.")
+        @Comment("If this option is enabled, this gamerule is disabled and we use default vanilla value which is 3.")
+        @Comment("If you know you won't use this gamerule you should enable this option.")
+        public boolean randomTickSpeed = false;
+
+    }
+
+}
